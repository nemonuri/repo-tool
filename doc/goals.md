# Goals

## 1. `GenerateFStarConfigJson` MSBuild Task

### Usage senario

1. Assume
    - **Bob** wants to write F* project, with vscode and F* assistance.
    - Bob installed `F* release` under **/My/Secretes/** directory.
    - Bob made git repository under **/My/FStarProj/RepoRoot/** , and writes **.fst.config.json**
    - '.fst.config.json' contains raw text of '/My/Secretes/' path, and Bob does not want to expose it to public. (1)
    - '.fst.config.json' contains lots of important options, and Bob wants to git keeps track of that options. (2)
    - (1) and (2) are contradiction, because Bob cannot split '.fst.config.json' file.
    - Bob wants to solve this problem, by detouring ã…¡ use MSBuild.

2. Bob creates **Tool.proj** and apply [Microsoft.Build.NoTargets](https://github.com/microsoft/MSBuildSdks/tree/main/src/NoTargets) SDK.

3. Bob writes '/My/Secretes/' path in **Private.props** a sub directory of '/My/FStarProj/RepoRoot/', and lets git ignores it.

4. Bob modifies Tool.proj to import Private.props

5. Bob makes default MSBuild target as **Invoke** in Tool.proj, that runs **GenerateFStarConfigJson** Task.

6. Bob invokes command `dotnet msbuild`
    1. 'sdk.g.fst.config.json' file is created. It contains information text like 'Auto Generated by Tool.proj. Do not Edit.'
    2. 'sdk.g.fst.config.json' line is added to '.gitignore'

7. Done!

### Test senario

1. Assume Input
    - Kind of 'fstar.exe'
      - **directory.fstar.exe** is directory.
      - **not-exist.fstar.exe** is not exist.
      - **txt.fstar.exe** is text file.
      - **return1.fstar.exe** just returns 1.
      - **return0.fstar.exe** just returns 0.
      - **stderr-version.fstar.exe** messages valid version to stderr, and returns 0.
      - **stdout1-version.fstar.exe** messages valid version to stdout, and returns 1.
      - **stdout0-version.fstar.exe** messages valid version to stdout, and returns 0.
      - **stdin.fstar.exe** waits until stdin(ReadKey), messages valid version to stdout, and returns 0.
      - **stdin_readline.fstar.exe** waits until stdin(ReadLine), messages valid version to stdout, and returns 0.
      - **sleep1s-stdout0-version.fstar.exe** sleeps 1 second, and messages valid version to stdout, and returns 0.
      - **sleep10s-stdout0-version.fstar.exe** sleeps 10 second, and messages valid version to stdout, and returns 0.
    - Mock MSBuild engine, which executes 'GenerateFStarConfigJson' task


2. Assume Output
    - **TaskSuccess** is success(true) or failure(false) of 'GenerateFStarConfigJson' task

3. Expected Result

| fstar.exe | TaskSuccess | *note*
| --- | --- | --- |
| directory.fstar | false ||
| not-exist.fstar | false ||
| txt.fstar | false ||
| return1.fstar | false ||
| return0.fstar | false ||
| stderr-version.fstar | false ||
| stdout1-version.fstar | true | Exitcode will be ignored. |
| stdout0-version.fstar | true ||
| stdin.fstar | false ||
| stdin_readline.fstar | false ||
| sleep1s-stdout0-version.fstar | true ||
| sleep10s-stdout0-version.fstar | false ||


### Deploy senario